<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PFSimple: PFSimple</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PFSimple
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">PFSimple </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<h1>General information</h1>
<p>The Paticle Finder Simple package is simplified version of the KF Partice package based on its mathematical apparatus. It is developed for the complete reconstruction of short-lived particles with their momentum, energy, mass, lifetime, decaylength, rapidity, etc. 2- and 3-body decays can get reconstructed. It is also possible to reconstruct multiple decays in one run as well as cascade decays.</p>
<h1>Requirements</h1>
<h2>Root</h2>
<p><a href="https://root.cern/install/">https://root.cern/install/</a></p>
<p>Version 6.20 or newer is recommended. Root with c++17 standard is strongly recommended.</p>
<h2>AnalysisTree</h2>
<p>Optional. Needed for building AnalysisTree interface.</p>
<p><a href="https://github.com/HeavyIonAnalysis/AnalysisTree">https://github.com/HeavyIonAnalysis/AnalysisTree</a></p>
<p>Both pre-installed AnalysisTree and automatically installed together with PFSimple framework can be used (see chapter Installation)</p>
<p>AnalysisTree with c++17 standard is strongly recommended.</p>
<h1>Installation</h1>
<p>Clone PFSimple</p>
<p>Source ROOT </p><div class="fragment"><div class="line">source /path-to-root/install/bin/thisroot.sh</div>
</div><!-- fragment --><p> To use pre-installed AnalysisTree set the environment variable: </p><div class="fragment"><div class="line">export AnalysisTree_DIR=/path-to-analysistree/install/lib/cmake/AnalysisTree</div>
</div><!-- fragment --><p> To build AnalysisTree automatically together with PFSimple use following cmake keys: </p><div class="fragment"><div class="line">-DPFSimple_BUNDLED_AT=ON</div>
<div class="line">-DPFSimple_BUNDLED_AT_VERSION=v2.3.4</div>
</div><!-- fragment --><p>You need to source root and export AnalysisTree each time when you are compiling project from 0 (perform cmake command) but have no need to do it when just recompiling project (perform just make).</p>
<p>Install PFSimple </p><div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake -DCMAKE_INSTALL_PREFIX=/path-to-install-pfsimple /path-to-source-pfsimple</div>
<div class="line">make -j install</div>
</div><!-- fragment --> <h1>Configuration of decay settings</h1>
<p>The program is configured with a JSON config file which contains various settings related to input and output as well as the decays to reconstruct. In the following, the different blocks and fields are explained. In <code>at_interface/config/config_template.json</code> all available JSON fields are listed.</p>
<h2>io</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Key   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>input_treename</code>   </td><td class="markdownTableBodyNone">name of the input AnalysisTree (for standard analysistree <code>rTree</code>, after running PID framework <code>pTree</code>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>rectracks_branchname</code>   </td><td class="markdownTableBodyNone">branchname of reconstructed tracks in input analysistree, default names: <code>VtxTracks</code> for standard analyistree, <code>RecParticles</code> after running Pid-framework    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>n_events</code>   </td><td class="markdownTableBodyNone">number of events to be processed, set to <code>-1</code> to process all events    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>save_options</code> (optional)   </td><td class="markdownTableBodyNone">defines save options for the candidates of all decays in this config (see next table)   </td></tr>
</table>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>save_options</code> Flag   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>make_plain_tree</code>   </td><td class="markdownTableBodyNone">normal root tree containing the candidates is written besides the default output tree in AnalysisTree format    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>signal_only</code>   </td><td class="markdownTableBodyNone">save only mc-true signal candidates    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>write_detailed_bg</code>   </td><td class="markdownTableBodyNone">detailed background information in output variable <code>generation</code>*   </td></tr>
</table>
<p>*Format of detailed background information in the <code>generation</code> variable:</p>
<p>format for bg for 2-body-decay: -m12 0 d2 d1 <br  />
 format for bg for 3-body-decay: -m13 m23 m12 d3 d2 d1 <br  />
 with m12: mother of daughter 1 &amp; 2 etc. <br  />
 code for daughters (d): <br  />
 1 - reco daughter is unmatched to mc <br  />
 2 - reco daughter is matched, but primary <br  />
 3 - reco daughter is secondary, produced not in decay from mother with not expected pdg <br  />
 4 - reco daughter is secondary, produced not in decay from mother with expected pdg <br  />
 5 - reco daughter is secondary, produced in decay from mother with not expected pdg <br  />
 6 - reco daughter is secondary, produced in decay from mother with expected pdg <br  />
 code for mothers (m): <br  />
 1 - daughters have the same mother <br  />
 2 - daughters have different mothers <br  />
 0 - at least one daughter does not have mother (e.g. primary) <br  />
</p>
<p>If detailed background is not selected or if mc match for mother is found, value of variable "generation" is: <br  />
 0 - no mc match for mother <br  />
 1 - mother is primary particle <br  />
 2 - mother is second generation etc.</p>
<h2>pid_mode</h2>
<p>Methods for particle identification: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>pid_mode</code>   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>0</code>   </td><td class="markdownTableBodyNone">no pid (only charge information is used! optional daughers must be set to 1 / -1 for pos / neg pdgs!)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">mc-pid    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>2</code>   </td><td class="markdownTableBodyNone">reconstructed TOF pid - default from Pid-framework*    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone">reconstructed TOF pid - pdg with max. pdg-purity is selected, if pdg-purity &gt;min. purity*    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>4</code>   </td><td class="markdownTableBodyNone">reconstructed TOF pid - pdg is selected, if pdg-purity &gt; min. purity (pdg-specfic purities are possible)*   </td></tr>
</table>
<p>** *for 2-4: Pid-framework needs to be applied first to include TOF-pid &amp; probabilities into the analysistree input-file**</p>
<h2>pid_purity</h2>
<p>Mimimum purities for pid-mode 3 &amp; 4:</p><ul>
<li><code>all_pdgs</code>: minimum purity is set for all pdgs (pdg-spefic purities need to be omitted) (in pid-mode 3 &amp; 4)</li>
<li><code>protons</code>, <code>pions</code>, etc: minimum purity is set specifically for every pdg (general purity will be overwritten, if pdg-specific purity is given) (in pid-mode 4)</li>
</ul>
<h2>decays</h2>
<p>One or multiple decays get can reconstructed in one run. Each decay is defined by several sub-blocks:</p>
<h3>mother</h3>
<ul>
<li><code>pdg_code</code></li>
<li><code>name</code> (chosen by user)</li>
<li><code>mass</code> (Unit: GeV/c^2) and <code>mass_sigma</code> (optional): if set to "-1" values from KFParticleDatabase are taken (if available)</li>
<li><code>cuts</code>: subblock for the definition of cuts to be applied to the mother (See <code>at_interface/config/config_template.json</code> for the available JSON keys and <code><a class="el" href="d6/de9/Constants_8hpp_source.html">Constants.hpp</a></code> for more details.)</li>
<li><code>save_options</code>: options for the saving of the reconstructed mother:</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Flag   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>mass_constraint</code>   </td><td class="markdownTableBodyNone">nonlinear mass constraint is applied on the mother particle which modifies the mother's state vector and covariance matrix to assure the 4-momentum is consitent with the pdg mass    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>transport_to_pv</code>   </td><td class="markdownTableBodyNone">mother is transported to the PV before saving    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>do_not_save_mother</code>   </td><td class="markdownTableBodyNone">writing of the mother into the output-file (e.g. the lower-level mother in cascade decays) is surpressed. If this option is selected, it is not possible to peform the MC-matching for the upper-level mother.   </td></tr>
</table>
<h3>daughters</h3>
<p>The 2 (3) daughters of the mother are be defined in 2 (3) subblocks (for 2-/3-body decays).</p><ul>
<li><code>pdg_code</code> (in JSON list format): first entry: daugher PDG; second and following entries (optional): additional pdgs or background can be considered as possible daughter candidates, for background set:<ul>
<li>for background: set to "1" / "-1" for pos / neg daughters</li>
<li>for tracks without TOF id: set to "2" / "-2" for pos / neg daughters (in pid-mode 2, 3, 4) In pid-mode 0 optional daughers "1" / "-1" for pos / neg pdgs must be added</li>
</ul>
</li>
<li><code>cuts</code>: subblock for the definition of cuts to be applied to the daughter (See <code>at_interface/config/config_template.json</code> for the available JSON keys and <code><a class="el" href="d6/de9/Constants_8hpp_source.html">Constants.hpp</a></code> for more details.)</li>
</ul>
<h3>secondary_mother_cuts (3-body-decays)</h3>
<p>Cuts on the secondary mothers (SM) of combinations of 2 daughters can have up to 3 entries (JSON list format): cuts for daughter combinations [1 &amp; 2, 1 &amp; 3, 2 &amp; 3]. E.g. for H3L-&gt;p + pi + d, a cut on the SM of p-pi can be applied. The cuts that test the mother against the PV, e.g. chi2topo, are inverted for the SM to exclude SMs that come from the PV. (See <code>at_interface/config/config_template.json</code> for the available JSON keys and <code><a class="el" href="d6/de9/Constants_8hpp_source.html">Constants.hpp</a></code> for more details.)</p>
<h2>output_cuts</h2>
<p>The optional <code>output_cuts</code> block contains AnalysisTree field cuts to be applied to the output candidates before storing them to disk. One can either select a certain range for a cut variable with <code>from</code> and <code>to</code> or select a specific value with <code>equal</code>. It is possible to chain several cuts.</p>
<h2>Cascade decays</h2>
<p>For the reconstruction of a cascade decay all consecutive decays are added into one config-file. The order of the decays need to be from last generation to first generation. Cascade decays with multiple stages as well as combinations of 2- and 3-body-decays can get reconstructed.</p>
<h1>Example Configs</h1>
<p>Several example parameter files can be found in the folder <code>at_interface/configs</code>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File   </th><th class="markdownTableHeadNone">Particle(s)   </th><th class="markdownTableHeadNone"><code>pid_mode</code>   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>config_template.json</code>   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">all available JSON fields listed    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>config_lambda_pidmode1_v1.json</code>   </td><td class="markdownTableBodyNone">Lambda   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">KFParticle cuts    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>config_lambda_pidmode1_v2.json</code>   </td><td class="markdownTableBodyNone">Lambda   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">optimized cuts    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>config_lambda_pidmode0.json</code>   </td><td class="markdownTableBodyNone">Lambda   </td><td class="markdownTableBodyNone"><code>0</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>config_lambda_pidmode2.json</code>   </td><td class="markdownTableBodyNone">Lambda   </td><td class="markdownTableBodyNone"><code>2</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>config_lambda_pidmode1_v3.json</code>   </td><td class="markdownTableBodyNone">Lambda   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">for machine learning applications    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>config_H3L_pidmode1.json</code>   </td><td class="markdownTableBodyNone">H3L   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">3-body decay    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>config_H3L_pidmode4.json</code>   </td><td class="markdownTableBodyNone">H3L   </td><td class="markdownTableBodyNone"><code>4</code>   </td><td class="markdownTableBodyNone">3-body decay, minimum purities applied    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>config_He5L_pidmode1.json</code>   </td><td class="markdownTableBodyNone">He5L   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">3-body decay    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>config_xi_pidmode1.json</code>   </td><td class="markdownTableBodyNone">Xi, Lambda   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">cascade decay    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>config_omega_pidmode1.json</code>   </td><td class="markdownTableBodyNone">Omega, Lambda   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">cascade decay    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>config_omegastar_pidmode1.json</code>   </td><td class="markdownTableBodyNone">Omega*, Xi, Lambda   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">cascade decay, 3-body decay    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>config_lambda_k0short_pidmode1.json</code>   </td><td class="markdownTableBodyNone">Lambda, K0Short   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<h1>First run</h1>
<p>Each time before running the prepared executable you should set the environment variables to let your system know where to find libraries: </p><div class="fragment"><div class="line">source /path-to-root/install/bin/thisroot.sh</div>
<div class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/path-to-pfsimple-installation/lib/</div>
<div class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/path-to-pfsimple-installation/external/lib/</div>
<div class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/path-to-analysistree-installation/lib/ #can be ommitted if PFSimple_BUNDLED_AT was set to ON</div>
</div><!-- fragment --><p>The reconstruction will be executed with the following command: </p><div class="fragment"><div class="line">at_interface/main_json filelist.txt config.json [--output &lt;file&gt;] [--plain-output &lt;file&gt;] [--set &lt;key&gt;=&lt;value&gt;]</div>
</div><!-- fragment --><p> The binary accepts 2 positional arguments: The path of the input filelist.txt file and the config file in JSON format. It is also possible to modify the output file paths with the <code>--output</code> and <code>--plain-output</code> optional arguments as well as to override keys in the JSON config file by adding keys like <code>--set decays[0].mother.cuts.LdL=4.0</code>.</p>
<h2>filelist.txt</h2>
<p>filelist.txt must be a text file with names (including paths) to AnalysisTree files which you want to analyze with PFSimple. Each file name should be on the next line, and the last symbol should also be a switch to next line. The example of filelist is in the source directory of PFSimple (filelist_example.txt) </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2
</small></address>
</div><!-- doc-content -->
</body>
</html>
